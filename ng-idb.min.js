!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(1),o=r(i),s=n(2),u=r(s),a=n(3),c=r(a),l=n(4),d=r(l),$=n(5),f=r($),h=n(6),p=r(h),m=n(7),y=r(m),v=n(8),g=r(v),b=n(9),w=r(b),_=n(10),z=r(_),I=n(11),j=r(I),k=n(12),P=r(k),O=n(13),S=r(O);(0,S.default)(angular.module("ng.idb",[])).constant("io",io).service("Clazzer",o.default).constant("idbVersion","0.0.1").service("idbRequest",u.default).service("idbOpenDBRequest",c.default).service("idbConsultant",d.default).service("idb",f.default).service("idbStore",p.default).service("idbIndex",y.default).service("idbEventTarget",g.default).service("idbModel",w.default).service("idbSocket",P.default).service("idbQuery",j.default).service("idbTransaction",z.default)},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){"ngInject";function e(e){Object.defineProperty(this,"clazz",{value:e||function(){}})}return Object.defineProperty(e.prototype,"inherit",{value:function(e){var t=function(){};return t.prototype=e.prototype,this.clazz.prototype=new t,this.clazz.prototype.constructor=this.clazz,this}}),Object.defineProperty(e.prototype,"static",{value:function(e,t){return Object.defineProperty(this.clazz,e,{value:t}),this}}),Object.defineProperty(e.prototype,"property",{value:function(e,t){return Object.defineProperty(this.clazz.prototype,e,t),this}}),Object.defineProperty(e.prototype,"method",{value:function(e,t){return this.property(e,{value:t}),this}}),Object.defineProperty(e.prototype,"getter",{value:function(e,t){return t||(t=e),this.property(e,{get:function(){return this.$me[t]}}),this}}),Object.defineProperty(e.prototype,"setter",{value:function(e,t){return t||(t=e),this.property(e,{set:function(e){this.$me[t]=e}}),this}}),Object.defineProperty(e.prototype,"handlerEvent",{value:function(e,t){return t||(t=e),this.property(e,{value:function(e){return this.$me[t]=e,this}}),this}}),e}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer",function(e){"ngInject";var t=new e({}).static("Pending","pending").static("Done","done");return new e(function(t){new e(this).static("$me",t)}).inherit(EventTarget).static("ReadyState",t.clazz).getter("$result","result").getter("$error","error").getter("$source","source").getter("$readyState","readyState").getter("$transaction","transaction").handlerEvent("$success","onsuccess").handlerEvent("$failed","onerror").property("$promise",{get:function(){var t=this;return t.$_promise?t.$_promise:(t.$_promise=new Promise(function(e,n){t.$success(function(t){e(t)}).$failed(function(e){n(e)})}),new e(t.$_promise).static("$request",t),t.$_promise)}}).clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer","idbRequest",function(e,t){"ngInject";return new e(function(e){t.apply(this,arguments)}).inherit(t).handlerEvent("$blocked","onblocked").handlerEvent("$upgradeneeded","onupgradeneeded").clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer","idbRequest",function(e,t){"ngInject";return new e(function(t){new e(this).static("$me",t)}).getter("$name","name").method("$get",function(e){return new t(this.$me.get.apply(this.$me,arguments)).$promise.then(function(e){return e.target.result})}).method("$getKey",function(e){return new t(this.$me.getKey.apply(this.$me,arguments)).$promise.then(function(e){return e.target.result})}).method("$getAll",function(e,n){return new t(this.$me.getAll.apply(this.$me,arguments)).$promise.then(function(e){return e.target.result})}).method("$getAllKeys",function(e,n){return new t(this.$me.getAllKeys.apply(this.$me,arguments)).$promise.then(function(e){return e.target.result})}).method("$count",function(e){return new t(this.$me.count.apply(this.$me,arguments)).$promise.then(function(e){return e.target.result})}).method("$openCursor",function(e,n){return new t(this.$me.openCursor.apply(this.$me,arguments))}).method("$openKeyCursor",function(e,n){return new t(this.$me.openKeyCursor.apply(this.$me,arguments))}).clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer","idbEventTarget","idbStore","idbModel","idbOpenDBRequest","idbTransaction","$log",function(e,t,n,r,i,o,s){"ngInject";var u=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;if(!u)return void alert("Su navegador no soporta una versión estable de indexedDB. Tal y como las características no serán validas");var a=function(t,n,r){new e(this).static("$name",t).static("$version",n).static("$socket",r)};return new e(a).inherit(t).property("$_upgradeneededs",{value:[]}).property("$_models",{value:{}}).property("$me",{get:function(){return this.$_me},set:function(e){this.$_me=e;var t=new Event("opened");this.$emit(t)}}).getter("$objectStoreNames","objectStoreNames").static("$open",function(e,t){return new i(u.open.apply(u,arguments))}).static("$drop",function(e){return new i(u.deleteDatabase.apply(u,arguments))}).static("$cmp",function(e,t){return u.cmp(e,t)}).method("$aborted",function(e){var t=this;return t.$bind("opened",function(){t.$me.onabort=e})}).method("$closed",function(e){var t=this;return t.$bind("opened",function(){t.$me.onclose=e})}).method("$error",function(e){var t=this;return t.$bind("opened",function(){t.$me.onerror=e})}).method("$versionChanged",function(e){var t=this;return t.$bind("opened",function(){t.$me.onversionchange=e})}).method("$upgradeneeded",function(e){return this.$_upgradeneededs.push(e),this}).method("$automigration",function(e){return this.$upgradeneeded(function(t,n,r){Object.keys(e).map(function(i){if(r.oldVersion<i&&i<=r.newVersion){var o=Array.isArray(e[i])?e[i]:[e[i]];s.log("migration v"+i+" starts"),o.map(function(e){e(t,n,r)})}})})}).method("$migrate",function(e){var t=this;return e?t.$model(e).$create():Object.keys(t.$_models).map(function(e){return t.$migrate(e)})}).method("$open",function(e,t){var n=this,r=null,i=null;return n.$opened?e&&e(n,r,i):n.$opened=(r=a.$open(n.$name,n.$version).$upgradeneeded(function(e){s.log("upgradeneeded idb: "+n.$name+" v"+n.$version),n.$me=e.target.result,n.$_upgradeneededs.map(function(t){t.apply(n,[n,r,e])})})).$promise.then(function(t){return s.log("opened idb: "+n.$name+" v"+n.$version),n.$me!==t.target.result&&(n.$me=t.target.result),i=t,e&&e(n,r,t),n}).catch(function(e){return r=null,n.$opened=null,t&&t(n,r,e),n}),n.$opened}).method("$drop",function(e){var t=this;return t.$opened=null,new Promise(function(n,r){var i=a.$drop(t.$name).$success(function(e){n(t)}).$failed(function(e){r(e)});e&&e(i)})}).method("$close",function(){return this.$opened=null,this.$me.close.apply(this.$me,arguments),this}).method("$createStore",function(e,t){return new n(this.$me.createObjectStore.apply(this.$me,arguments))}).method("$dropStore",function(e){return this.$me.deleteObjectStore.apply(this.$me,arguments),this}).method("$model",function(e,t){return this.$_models[e]?this.$_models[e]:this.$_models[e]=r(this,e,t||this.$socket)}).method("$transaction",function(e,t){var n=this,r=arguments;return n.$open().then(function(e){return new o(e.$me.transaction.apply(e.$me,r))})}).method("$store",function(t){function n(e){return function(n){return r.$transaction(t,e).then(function(e){var i={},o=t.map(function(t){return i[t]=e.$store(t)});return n&&n.apply(r,o),i})}}var r=this;return Array.isArray(t)||(t=[t]),new e({}).static("$reader",n(o.TransactionMode.ReadOnly)).static("$writer",n(o.TransactionMode.ReadWrite)).clazz}).clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=["Clazzer","idbRequest","idbIndex","idbConsultant","$log",function(e,t,r,i,o){"ngInject";return new e(function(t){new e(this).static("$me",t)}).inherit(i).getter("$keyPath","keyPath").getter("$indexNames","indexNames").getter("$transaction","transaction").getter("$autoIncrement","autoIncrement").method("$put",function(e,n){return new t(this.$me.put.apply(this.$me,arguments)).$promise.then(function(e){return e.target.result})}).method("$add",function(e,n){return new t(this.$me.add.apply(this.$me,arguments)).$promise.then(function(e){return e.target.result})}).method("$delete",function(e){return new t(this.$me.delete.apply(this.$me,arguments)).$promise.then(function(e){})}).method("$clear",function(){return new t(this.$me.clear.apply(this.$me,arguments)).$promise.then(function(e){})}).method("$index",function(e){return new r(this.$me.index.apply(this.$me,arguments))}).method("$createIndex",function(e,t,i){return"string"==typeof e&&(e=[e]),"object"==("undefined"==typeof t?"undefined":n(t))&&(i=t,t=null),t||(t=e.sort().join("_")),new r(this.$me.createIndex(t,e,i))}).method("$deleteIndex",function(e){Array.angular.isArray(e)&&(e=e.sort().join("_")),this.$me.deleteIndex(e)}).clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer","idbConsultant",function(e,t){"ngInject";return new e(function(t){new e(this).static("$me",t)}).inherit(t).getter("$objectStore","objectStore").getter("$keyPath","keyPath").getter("$multiEntry","multiEntry").getter("$unique","unique").clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer",function(e){"ngInject";return new e(function(){}).property("$_listeners",{value:[]}).method("$bind",function(e,t){return e in this.$_listeners||(this.$_listeners[e]=[]),this.$_listeners[e].push(t),this}).method("$unbind ",function(e,t){if(e in this.$_listeners)for(var n=this.$_listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return n.splice(r,1),this.$unbind(e,t);return this}).method("$emit",function(e){if(e.type in this.$_listeners)for(var t=this.$_listeners[e.type],n=0,r=t.length;n<r;n++)t[n].call(this,e);return this}).clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer","idbQuery","idbEventTarget","lbResource","$timeout",function(e,t,n,r,i){"ngInject";var o=function(e,t,n){var r=t.split("."),i=r.pop();return function e(t){if(0==r.length)return n(t,i);var o=r.shift();return"undefined"==typeof t[o]&&(t[o]={}),e(t[o])}(e)},s=function(e,t){return o(e,t,function(e,t){return e[t]})},u=function(e,t,n){return o(e,t,function(e,t){e[t]=n}),e};return function(o,a,c){function l(){}return new e(l).inherit(n).static("$db",o).static("$name",a).static("$socket",c).static("$id",{keyPath:"id",autoIncrement:!0}).static("$fields",{id:{id:!0,name:"id",type:"number"}}).static("$indexesToCreate",[]).static("$instances",{}).static("$getKeyFrom",function(e){return s(e,this.$id.keyPath)}).static("$addIndex",function(e,t,n){return this.$indexesToCreate.push(arguments),this}).static("$create",function(e){var t=this,n=t.$db.$createStore(t.$name,t.$id);return t.$indexesToCreate.map(function(e){n.$createIndex.apply(n,e)}),e&&e(t,n),t}).static("$drop",function(e){return this.$db.$dropStore(this.$name),this}).static("$writer",function(e){var t=this;return t.$db.$store(t.$name).$writer(e).then(function(e){return e[t.$name]})}).static("$reader",function(e){var t=this;return t.$db.$store(t.$name).$reader(e).then(function(e){return e[t.$name]})}).static("$versioning",function(e,t){return this.$_versioning||("function"==typeof e&&(t=e,e=void 0),e||(e=this.$name+"_versioning"),this.$_versioning=this.$db.$model(e).$key(this.$id.keyPath,!0).$field("hash",{type:"string",required:!0})),t&&t(this.$_versioning),this}).static("$remote",function(e,t,n){return this.$_remote=r.apply(r,arguments),this}).static("$getInstance",function(e){return void 0===e||null===e?new this:(this.$instances[e]||(this.$instances[e]=new this,this.$instances[e].$set(this.$id.keyPath,e)),this.$instances[e])}).static("$put",function(e,t){var n=this,r=arguments,i=this.$getValues(e);return r[0]=i,n.$writer().then(function(e){return e.$put.apply(e,r).then(function(e){var t=n.$getInstance(e);return t.$setValues(i),t.$setLocalValues(i),t})})}).static("$add",function(e,t){var n=this,r=arguments,i=this.$getValues(e);return r[0]=i,n.$writer().then(function(e){return e.$add.apply(e,r).then(function(e){var t=n.$getInstance(e);return t.$setValues(i),t.$setLocalValues(i),t})})}).static("$delete",function(e){var t=arguments;return this.$writer().then(function(e){return e.$delete.apply(e,t)})}).static("$clear",function(){var e=arguments;return this.$writer().then(function(t){return t.$clear.apply(t,e)})}).static("$get",function(e){var t=this,n=arguments,r=this.$getInstance(e);return r.$promise=t.$reader().then(function(e){return e.$get.apply(e,n).then(function(e){return r.$setValues(e),r.$setLocalValues(e),r})}),r}).static("$getKey",function(e){var t=this,n=arguments;return t.$reader().then(function(e){return e.$getKey.apply(e,n)})}).static("$getAll",function(e,t){var n=this,r=arguments,i=[];return i.$promise=n.$reader().then(function(e){return e.$getAll.apply(e,r).then(function(e){return e.map(function(e){var t=n.$getInstance(n.$getKeyFrom(e));return t.$setValues(e),t.$setLocalValues(e),i.push(t),t})})}),i}).static("$getAllKeys",function(e,t){var n=arguments,r=[];return r.$promise=this.$reader().then(function(e){return e.$getAllKeys.apply(e,n).then(function(e){return e.map(function(e){return r.push(e),e})})}),r}).static("$count",function(e){var t=arguments;return this.$reader().then(function(e){return e.$count.apply(e,t)})}).static("$find",function(e){return new t(this,e)}).static("$field",function(e,t){return"string"==typeof t&&(t={type:t}),t.name=e,this.$fields[e]=t,this}).static("$key",function(e,t,n){return"boolean"==typeof e&&(t=e),void 0!==e&&null!==e&&"boolean"!=typeof e||(e="id"),"string"==typeof t&&(n=t,t=null),void 0!==t&&null!==t||(t=!0),"boolean"!=typeof t&&"string"===n||(n="number"),this.$id.keyPath=e,this.$id.autoIncrement=t,this.$field(e,{id:!0,type:n})}).static("$getValues",function(e){var t={};return Object.keys(this.$fields).map(function(n){var r=s(e,n);void 0!==r&&u(t,n,r)}),t}).static("$build",function(e){return e(this),this}).property("$_values",{value:new e({}).static("local",{}).static("remote",{}).clazz}).property("$_versions",{value:{}}).method("$get",function(e){return s(this,e)}).method("$set",function(e,t){return u(this,e)}).method("$getValues",function(e){return l.$getValues(e||this)}).method("$getLocalValues",function(){return this.$getValues(this.$_values.local)}).method("$getRemoteValues",function(){return this.$getValues(this.$_values.remote)}).method("$setValues",function(e){var t=this;return Object.keys(e||{}).map(function(n){u(t,n,e[n])}),t}).method("$setLocalValues",function(e){var t=this;return Object.keys(e||{}).map(function(n){u(t.$_values.local,n,e[n])}),t}).method("$setRemoteValues",function(e){var t=this;return Object.keys(e||{}).map(function(n){u(t.$_values.remote,n,e[n])}),t}).method("$key",function(e){return s(e,this.$id.keyPath)}).method("$listen",function(e){var t=this;if(!this.$socket)throw new Error("idbModel.DoesNotHaveSocketInstance");this.$socket.subscribe({modelName:l.$name,eventName:"update",modelId:t.$key()},function(e){i(function(){t.$setRemoteValues(e.values,e.version)})})}).clazz}}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer","idbStore",function(e,t){"ngInject";var n=new e({}).static("ReadOnly","readonly").static("ReadWrite","readwrite").static("VersionChange","versionchange");return new e(function(t){new e(this).static("$me",t)}).inherit(EventTarget).static("TransactionMode",n.clazz).getter("$db","db").getter("$mode","mode").getter("$error","error").getter("$storeNames","objectStoreNames").handlerEvent("$aborted","onabort").handlerEvent("$completed","oncomplete").handlerEvent("$failed","onerror").method("$store",function(e){return new t(this.$me.objectStore.apply(this.$me,arguments))}).method("$abort",function(){this.$me.abort.apply(this.$me,arguments)}).property("$promise",{get:function(){var t=this;return t.$_promise?t.$_promise:(t.$_promise=new Promise(function(e,n){t.$completed(function(t){e(t)}).$failed(function(e){n(e)})}),new e(t.$_promise).static("$transaction",t),t.$_promise)}}).clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer",function(e){"ngInject";return new e(function(t,n){new e(this).static("$model",t).static("$query",n)}).property("$result",{value:[]}).method("$getResult",function(e){var t=this;return t.$result.$promise||(t.$result.$promise=t.$model.$reader().then(function(e){return new Promise(function(n,r){var i=[],o=e.$openCursor();o.$success(function(e){var r=o.$me.result;if(!r)return n(i);var s=t.$model.$getInstance(r.key);s.$setValues(r.value),s.$setLocalValues(r.value),t.$result.push(s),i.push(s),r.continue()}).$failed(function(e){r(e)})})})),t.$result}).clazz}]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Clazzer","io","$log",function(e,t,n){"ngInject";return new e(function t(n,r,i){new e(this).static("$url",n||t.$defUrlServer).static("$accessTokenId",r||t.$defAccessTokenId).static("$currentUserId",i||t.$defCurrentUserId),this.$connect()}).property("$_listeners",{value:[]}).method("$connect",function(){var e=this.$socket=t.connect(this.$url);e.on("connect",function(){n.log("connected"),e.emit("authentication",{id:this.$accessTokenId,userId:this.$currentUserId}),e.on("authenticated",function(){n.log("User is authenticated")})})}).method("$subscribe",function(e,t){var n=e.modelName+"."+e.eventName;"number"==typeof e.modelId&&(n=n+"."+e.modelId),this.$socket.on(n,t),this.$pushListener(n,t)}).method("$pushListener",function(e,t){this.$_listeners.push(e)}).method("$unsubscribe",function(e){this.$socket.removeAllListeners(e);var t=this.$_listeners.indexOf(e);t!=-1&&this.$_listeners.splice(t,1)}).static("$setUrlServer",function(e){return this.$defUrlServer=e,this}).static("$setCredentials",function(e,t){return this.$defAccessTokenId=e,this.$defCurrentUserId=t,this}).clazz.$setUrlServer(null).$setCredentials(null,null)}]},function(e,t){"use strict";function n(e){function t(e){var t=e.match(/^(?:https?:)?\/\/([^\/]+)/);return t?t[1]:null}var n=location.host,r=function e(){"ngInject";function t(e,t,n){try{var r=i+t;null==n&&(n=""),e[r]=n}catch(e){console.log("Cannot access local/session storage:",e)}}function n(e){var t=i+e;return localStorage[t]||sessionStorage[t]||null}function e(){var e=this;r.forEach(function(t){e[t]=n(t)}),e.currentUserData=null}var r=["accessTokenId","currentUserId","rememberMe"],i="$idb-lb$";return e.prototype.save=function(){var e=this,n=e.rememberMe?localStorage:sessionStorage;r.forEach(function(r){t(n,r,e[r])})},e.prototype.setUser=function(e,t,n){var r=this;r.accessTokenId=e,r.currentUserId=t,r.currentUserData=n},e.prototype.clearUser=function(){var e=this;e.accessTokenId=null,e.currentUserId=null,e.currentUserData=null},e.prototype.clearStorage=function(){r.forEach(function(e){t(sessionStorage,e,null),t(localStorage,e,null)})},new e},i=function(e,r){"ngInject";return{request:function(i){var o=t(i.url);if(o&&o!==n)return i;if(r.accessTokenId)i.headers[authHeader]=r.accessTokenId;else if(i.__isGetCurrentUser__){var s={body:{error:{status:401}},status:401,config:i,headers:function(){}};return e.reject(s)}return i||e.when(i)}}};i.$inject=["$q","lbAuth"];var o=function(){"ngInject";var e=this,r={urlBase:"/api",authHeader:"authorization"};n=t(r.urlBase)||location.host,e.setAuthHeader=function(e){r.authHeader=e},e.getAuthHeader=function(){return r.authHeader},e.setUrlBase=function(e){r.urlBase=e,n=t(r.urlBase)||location.host},e.getUrlBase=function(){return r.urlBase},e.$get=["$resource",function(e){var t=function(t,n,i){Object.keys(i).map(function(e){i[e].originalUrl=i[e].url,i[e].url=r.urlBase+i[e].url});var o=e(r.urlBase+t,n,i);return o.prototype.$save=function(e,t){var n=o.upsert.call(this,{},this,e,t);return n.$promise||n},o};return t.getUrlBase=function(){return r.urlBase},t.getAuthHeader=function(){return r.authHeader},t}]};return e.factory("lbAuth",r).provider("lbResource",o).factory("lbAuthRequestInterceptor",i).config(["$httpProvider",function(e){"ngInject";e.interceptors.push("lbAuthRequestInterceptor")}])}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}]);