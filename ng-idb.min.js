!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(1),i=r(o),u=n(2),c=r(u),a=n(3),s=r(a),l=n(4),f=r(l),d=n(5),v=r(d),p=n(6),g=r(p);(0,g.default)(angular.module("ng.idb",[])).constant("idbVersion","0.0.1").service("idbEvents",c.default).service("idbUtils",i.default).service("qs",s.default).service("idb",f.default).service("idbModel",v.default)},function(e,t){"use strict";function n(e){"ngInject";function t(e){return"function"==typeof e||null==e||void 0==e}function n(e){if(!t(e)){var n=new Error("Invalid callback");throw n.name="InvalidCallback",n}}function o(e,t){"string"==typeof t&&(t=[t]);for(var n in t)if(("undefined"==typeof e?"undefined":r(e))==t[n])return;var o=new Error("Invalid value: "+e+" must be "+t.join(" or "));throw o.name="InvalidValue",o}function i(e,t){e=Array.prototype.slice.call(e),"string"==typeof t&&(t=[t]);for(var n in e)if(t[n]){if(null==t[n])continue;if("string"==typeof t[n]||"object"==r(t[n])){o(e[n],t[n]);continue}if("function"==typeof t[n]&&t[n](e[n]))continue;var i=new Error("Invalid validator to: "+e[n]+" must be "+t[n]);throw i.name="InvalidValidator",i}}return{isCallback:t,mustBeCallback:n,mustBe:o,validate:i}}n.$inject=["$q"],Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=n},function(e,t){"use strict";function n(){return{DB_ERROR:"cb.error"}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(){"ngInject";function e(e){function t(){if(o.length){var e=o.shift();e.apply(null,r.resultArgs),i.push(e),t()}}function n(){if(u.length){var e=u.shift();e.apply(null,r.error),c.push(e),n()}}var r=this,o=[],i=[],u=[],c=[];r.promise={},r.$resolved=!1,r.resolve=function(){r.$resolved||(r.$resolved=!0,r.resultArgs=Array.prototype.slice.call(arguments),t())},r.reject=function(e){r.$resolved||(r.$resolved=!0,r.error=e||{},n())},r.promise.then=function(e){return o.push(e),r.$resolved&&!r.error&&t(),r},r.promise.catch=function(e){return u.push(e),r.$resolved&&r.error&&n(),r},r.promise.done=function(e){return o.push(function(){e.apply(null,[null].concat(r.resultArgs))}),u.push(function(){e.apply(null,r.error)}),r.$resolved&&(r.error?n():t()),r},e&&r.promise.done(e)}return e.defer=function(t){return new e(t)},e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e,t,n,r,o){"ngInject";var i=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;return i?function(u,c){var a=this;n.validate(arguments,["string","number"]);var s={},l=e.defer(),f=e.defer(),d=!1,v=null;a.models={},a.bind=function(e,t){n.validate(arguments,["string","function"]),s[e]||(s[e]=[]),s[e].push(t)},a.unbind=function(e,t){if(n.validate(arguments,["string","function"]),s[e]){var r=s[e].indexOf(t);r!=-1&&s[e].splice(r,1)}},a.trigger=function(e,t){n.validate(arguments,["string","object"]),o.log(u+".v"+(c||1)+": "+e);for(var r in s[e])s[e][r].apply(a,t)},a.error=function(e){return a.bind(r.DB_ERROR,e),a},a.open=function(){function e(){var e=i.open(u,c);e.onupgradeneeded=function(t){l.resolve(t,e)},e.onsuccess=function(t){v=e,e.onerror=function(e){o.error("Database error: "+e.target.errorCode),a.trigger(r.DB_ERROR,[e])},f.resolve(t,e)},e.onerror=function(t){f.reject(e.errorCode)}}return d?f:(d=!0,e(),f)},a.model=function(e){n.validate(arguments,["string"]);var r=a.models[e];return r||(r=t(a,e)),a.models[e]=r,r},a.createStore=function(e,t){n.validate(arguments,["string",["object","undefined"]]),l.promise.then(function(n,r){r.result.createObjectStore(e,t)})},a.createIndex=function(e,t,r,o){n.validate(arguments,["string","string","string",["object","undefined"]]),l.promise.then(function(n,i){var u=i.transaction.objectStore(e);u.createIndex(t,r,o)})},a.transaction=function(t,r,o,i){n.validate(arguments,["string","string","function",["function","undefined"]]);var u=e.defer(i);return f.promise.then(function(e,n){var i=n.result.transaction(t,r),c=o(i);i.oncomplete=function(e){u.resolve(e,c)},i.onabort=function(){u.reject(i.error)}}),u},a.create=function(t,r,o){n.validate(arguments,["string",["object","function"],["function","undefined"]]);var i=e.defer(o);return a.transaction(t,"readwrite",function(e){var n=e.objectStore(t).put(r.values());n.onsuccess=function(e){i.resolve(e,r)},n.onerror=function(){i.reject(n)}}),i.$promise},a.get=function(t,r,o,i){n.validate(arguments,["function","string",null,["function","undefined"]]);var u=e.defer(i),c=t.getInstance(o);return c.$promise=u.promise,c.$resolved=!1,a.transaction(r,"readonly",function(e){var t=e.objectStore(r),n=t.get(o);n.onsuccess=function(){void 0!=n.result&&(c.setAttributes(n.result),c.$isNew=!1),c.$resolved=!0,u.resolve(c)},n.onerror=function(){u.reject(c)}}),c},a.find=function(t,r,o,i){n.validate(arguments,["function","string",["object","undefined"],["function","undefined"]]);var u=e.defer(i),c=[];return c.$promise=u.promise,c.$resolved=!1,a.transaction(r,"readonly",function(e){var n=e.objectStore(r),o=n.openCursor();o.onsuccess=function(){var e=o.result;if(!e)return c.$resolved=!0,u.resolve(c);var n=t.getInstanceFromObject(e.value);n.$isNew=!1,c.push(n),e.continue()}}),c};var p=void 0;Object.keys(p={onOpen:f,onUpgradeNeeded:l}).map(function(e){p[e].promise.done(function(t){var n=u+".v"+(c||1)+": "+e;t?o.error(n,t):o.log(n)}),a[e]=function(t){return n.validate(arguments,["function"]),p[e].promise.done(t),a}})}:void alert("Su navegador no soporta una versión estable de indexedDB. Tal y como las características no serán validas")}n.$inject=["qs","idbModel","idbUtils","idbEvents","$log"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e,t,n){"ngInject";return function(r,o){function i(e){this.setAttributes(e||{}),this.constructor(e),this.$isNew=!0,this.$record=null}t.validate(arguments,[null,"string"]);var u={keyPath:"id",autoIncrement:!0},c={},a={},s=null;return i.id=function(e){return t.validate(arguments,["object"]),u=e,i},i.createStore=function(){return r.createStore(o,u),i},i.index=function(e,t,n){return r.createIndex(o,e,t,n),i},i.build=function(e){return t.validate(arguments,["function"]),e(i),i},i.fields=function(e){return t.validate(arguments,["object"]),c={},c[u.keyPath]={type:"number",required:!0},Object.keys(e).map(function(t){var n=e[t];"string"==typeof e[t]&&(n={type:n}),c[t]=n}),i},i.remote=function(e,r,o){return t.validate(arguments,["string","object","object"]),s=n(e,r,o),i},i.create=function(n,r){if(t.validate(arguments,["object",["function","undefined"]]),void 0===n.length)return i.getInstanceFromObject(record).create(r);var o=Array.prototype.slice.call(n),u=[],c=e.defer(r);return function e(){return 0==o.length?c.resolve(u):void i.create(o.shift(),function(t,n){return t?c.reject(t):(u.push(n),void e())})}(),c},i.searchDeepField=function(e,n,r){t.validate(arguments,["object","string",["function","undefined"]]);var o=n.split("."),i=o.pop();return function e(t){if(0==o.length)return r(t,i);var n=o.shift();return"undefined"==typeof t[n]&&(t[n]={}),e(t[n])}(e)},i.getKeyFrom=function(e){return i.searchDeepField(e,u.keyPath,function(e,t){return e[t]})},i.getInstance=function(e){return e?(a[e]||(a[e]=new i),a[e]):new i},i.getInstanceFromObject=function(e){t.validate(arguments,["object"]);var n=i.getInstance(i.getKeyFrom(e));return n.setAttributes(e),n},i.get=function(e,t){return r.get(i,o,e,t)},i.find=function(e,t){var n=Array.prototype.slice.call(arguments);return t=n.pop(),e=n.pop(),s&&s.find(e,t).$promise.then(function(e){e.map(function(e,t){i.get(i.getKeyFrom(e)).$promise.then(function(t){t.setAttributes(e).resource(e),t.$isNew&&t.create()})})}).catch(function(e){console.log(["err",e])}),r.find(i,o,e,t)},i.prototype.setAttributes=function(e){var n=this;return t.validate(arguments,["object"]),Object.keys(e).map(function(t){n.set(t,e[t])}),n},i.prototype.get=function(e){var t=this;return i.searchDeepField(t,e,function(e,t){return e[t]})},i.prototype.set=function(e,t){var n=this;return i.searchDeepField(n,e,function(e,r){return e[r]=t,n})},i.prototype.values=function(){var e=this,t={};return Object.keys(c).map(function(n){i.searchDeepField(t,n,function(t,r){t[r]=e.get(n)})}),t},i.prototype.constructor=function(e){},i.prototype.create=function(e){var t=this;return r.create(o,this,function(n,r){if(n)return void(e&&e(n));if(t.set(u.keyPath,r.target.result),t.$isNew=!1,a[t.get(u.keyPath)]){if(a[t.get(u.keyPath)]!==t)throw new Error("idbModel.TwoInstancesWithSameKey")}else a[t.get(u.keyPath)]=t;e&&e.apply(null,[null].concat(Array.prototype.slice.call(arguments)))})},i.prototype.resource=function(e){return this.$record=e,this},i}}n.$inject=["qs","idbUtils","lbResource"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e){function t(e){var t=e.match(/^(?:https?:)?\/\/([^\/]+)/);return t?t[1]:null}var n=location.host,r=function e(){"ngInject";function t(e,t,n){try{var r=o+t;null==n&&(n=""),e[r]=n}catch(e){console.log("Cannot access local/session storage:",e)}}function n(e){var t=o+e;return localStorage[t]||sessionStorage[t]||null}function e(){var e=this;r.forEach(function(t){e[t]=n(t)}),e.currentUserData=null}var r=["accessTokenId","currentUserId","rememberMe"],o="$idb-lb$";return e.prototype.save=function(){var e=this,n=e.rememberMe?localStorage:sessionStorage;r.forEach(function(r){t(n,r,e[r])})},e.prototype.setUser=function(e,t,n){var r=this;r.accessTokenId=e,r.currentUserId=t,r.currentUserData=n},e.prototype.clearUser=function(){var e=this;e.accessTokenId=null,e.currentUserId=null,e.currentUserData=null},e.prototype.clearStorage=function(){r.forEach(function(e){t(sessionStorage,e,null),t(localStorage,e,null)})},new e},o=function(e,r){"ngInject";return{request:function(o){var i=t(o.url);if(i&&i!==n)return o;if(r.accessTokenId)o.headers[authHeader]=r.accessTokenId;else if(o.__isGetCurrentUser__){var u={body:{error:{status:401}},status:401,config:o,headers:function(){}};return e.reject(u)}return o||e.when(o)}}};o.$inject=["$q","lbAuth"];var i=function(){"ngInject";var e=this,r={urlBase:"/api",authHeader:"authorization"};n=t(r.urlBase)||location.host,e.setAuthHeader=function(e){r.authHeader=e},e.getAuthHeader=function(){return r.authHeader},e.setUrlBase=function(e){r.urlBase=e,n=t(r.urlBase)||location.host},e.getUrlBase=function(){return r.urlBase},e.$get=["$resource",function(e){var t=function(t,n,o){Object.keys(o).map(function(e){o[e].originalUrl=o[e].url,o[e].url=r.urlBase+o[e].url});var i=e(r.urlBase+t,n,o);return i.prototype.$save=function(e,t){var n=i.upsert.call(this,{},this,e,t);return n.$promise||n},i};return t.getUrlBase=function(){return r.urlBase},t.getAuthHeader=function(){return r.authHeader},t}]};return e.factory("lbAuth",r).provider("lbResource",i).factory("lbAuthRequestInterceptor",o).config(["$httpProvider",function(e){"ngInject";e.interceptors.push("lbAuthRequestInterceptor")}])}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}]);