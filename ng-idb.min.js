!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(1),i=r(o),u=n(2),a=r(u),c=n(3),s=r(c),l=n(4),d=r(l),f=n(5),v=r(f),p=n(6),g=r(p),h=n(7),b=r(h),y=n(8),m=r(y);(0,m.default)(angular.module("ng.idb",[])).constant("io",io).constant("idbVersion","0.0.1").service("idbEvents",a.default).service("idbUtils",i.default).service("qs",s.default).service("idb",d.default).service("idbModel",v.default).service("idbQuery",g.default).service("idbSocket",b.default)},function(e,t){"use strict";function n(e){"ngInject";function t(e,t){o.array(t)||(t=[t]);for(var n in t){var i=t[n];if("string"==typeof i){if("function"==typeof o[i]){if(o[i](e))return!0}else if(("undefined"==typeof e?"undefined":r(e))==i)return!0}else if("function"==typeof i&&i(args[n]))return!0}return!1}function n(e,n){e=Array.prototype.slice.call(e),"string"==typeof n&&(n=[n]);for(var r in e){var o=e[r],i=n[r];if(i&&!t(o,i)){var u=new Error("Invalid validator to: "+e[r]+" must be "+i);throw u.name="InvalidValidator",u}}}var o={callback:function(e){return"function"==typeof e||null==e||void 0==e},array:function(e){return Array.isArray(e)}};return{validate:n}}n.$inject=["$q"],Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=n},function(e,t){"use strict";function n(){return{DB_ERROR:"cb.error",MODEL_INSTANCED:"model.instanced",MODEL_QUERIED:"model.queried",MODEL_UNQUERIED:"model.unqueried"}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(){"ngInject";function e(e){function t(){if(o.length){var e=o.shift();e.apply(null,r.resultArgs),i.push(e),t()}}function n(){if(u.length){var e=u.shift();e.apply(null,r.error),a.push(e),n()}}var r=this,o=[],i=[],u=[],a=[];r.promise={},r.$resolved=!1,r.resolve=function(){r.$resolved||(r.$resolved=!0,r.resultArgs=Array.prototype.slice.call(arguments),t())},r.reject=function(e){r.$resolved||(r.$resolved=!0,r.error=e||{},n())},r.promise.then=function(e){return o.push(e),r.$resolved&&!r.error&&t(),r.promise},r.promise.catch=function(e){return u.push(e),r.$resolved&&r.error&&n(),r.promise},r.promise.done=function(e){return o.push(function(){e.apply(null,[null].concat(r.resultArgs))}),u.push(function(){e.apply(null,r.error)}),r.$resolved&&(r.error?n():t()),r},e&&r.promise.done(e)}return e.defer=function(t){return new e(t)},e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e,t,n,r,o,i,u,a,c){"ngInject";function s(u,a,c){var s=this;n.validate(arguments,["string","number",["object","undefined"],["object","undefined"]]);var d={},f=t.defer(),v=t.defer(),p=t.defer(),g=!1,h=null;s.models={},s.bind=function(e,t){n.validate(arguments,["string","function"]),d[e]||(d[e]=[]),d[e].push(t)},s.unbind=function(e,t){if(n.validate(arguments,["string","function"]),d[e]){var r=d[e].indexOf(t);r!=-1&&d[e].splice(r,1)}},s.trigger=function(t,r){n.validate(arguments,["string","object"]),e.log(u+".v"+(a||1)+": "+t);for(var o in d[t])d[t][o].apply(s,r)},s.error=function(e){return s.bind(r.DB_ERROR,e),s},s.open=function(){function t(){var t=l.open(u,a);t.onupgradeneeded=function(e){f.resolve(e,t)},t.onsuccess=function(n){h=t,t.onerror=function(t){e.error("Database error: "+t.target.errorCode),s.trigger(r.DB_ERROR,[t])},v.resolve(n,t)},t.onerror=function(e){v.reject(t.errorCode,e)}}return g?v:(g=!0,l.deleteDatabase(u).onsuccess=t,v)},s.model=function(e,t){n.validate(arguments,["string",["undefined","object"]]);var r=s.models[e];return r||(r=o(s,e,t||c)),s.models[e]=r,r},s.query=function(e,t){return new i(s,e,t)},s.createStore=function(e,t){n.validate(arguments,["string",["object","undefined"]]),f.promise.then(function(n,r){r.result.createObjectStore(e,t)})},s.createIndex=function(e,t,r,o){n.validate(arguments,["string","string","string",["object","undefined"]]),f.promise.then(function(n,i){var u=i.transaction.objectStore(e);u.createIndex(t,r,o)})},s.transaction=function(e,r,o){n.validate(arguments,["string","string","function"]);var i=t.defer();return v.promise.then(function(t,n){var u=n.result.transaction(e,r),a=o(u);u.oncomplete=function(e){i.resolve(e,a)},u.onabort=function(){i.reject(u.error)}}),i},s.put=function(e,r){n.validate(arguments,["string",["object","function"]]);var o=t.defer();return s.transaction(e,"readwrite",function(t){var n=t.objectStore(e).put(r.$getValues());n.onsuccess=function(e){r.$setKey(e.target.result),o.resolve(r,e)},n.onerror=function(e){o.reject(e)}}),o},s.get=function(r,o){n.validate(arguments,["function",["string","number"]]);var i=t.defer(),u=r.getInstance(o),a=r.getModelName();return u.$promise=i.promise,u.$resolved=!1,s.transaction(a,"readonly",function(t){var n=t.objectStore(a),c=n.get(o);c.onsuccess=function(t){r.getVersionOf(o).promise.then(function(e){void 0!=c.result&&u.$setLocalValues(c.result,e?e.hash:null),u.$resolved=!0,i.resolve(u)}).catch(function(t){e.error(["any error",t])})},c.onerror=function(e){i.reject(u)}}),u},s.find=function(o,i){n.validate(arguments,["function",["object","undefined"]]);var u=o.getModelName(),a=t.defer(),c=[];return c.$promise=a.promise,c.$resolved=!1,s.transaction(u,"readonly",function(t){var n=t.objectStore(u),i=n.openCursor();i.onsuccess=function(){var t=i.result;if(!t)return c.$resolved=!0,a.resolve(c);var n=o.getKeyFrom(t.value);o.getVersionOf(n).promise.then(function(e){var i=o.getInstance(n);i.$setLocalValues(t.value,e?e.hash:null),i.$resolved=!0,i.$emit(r.MODEL_QUERIED,c),c.push(i),t.continue()}).catch(function(t){e.error(["any error",t])})}}),c};var b=void 0;Object.keys(b={onOpen:v,onUpgradeNeeded:f,onSocketConnected:p}).map(function(t){b[t].promise.done(function(n){var r=u+".v"+(a||1)+": "+t;n?e.error(r,n):e.log(r)}),s[t]=function(e){return n.validate(arguments,["function"]),b[t].promise.done(e),s}})}var l=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;return l?s:void alert("Su navegador no soporta una versión estable de indexedDB. Tal y como las características no serán validas")}n.$inject=["$log","qs","idbUtils","idbEvents","idbModel","idbQuery","idbSocket","lbAuth","$timeout"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e,t,n,r,o,i){"ngInject";var u=function(e,t,r){n.validate(arguments,["object","string","function"]);var o=t.split("."),i=o.pop();return function e(t){if(0==o.length)return r(t,i);var n=o.shift();return"undefined"==typeof t[n]&&(t[n]={}),e(t[n])}(e)};return function(e,a,c){function s(e){var t=this;n.validate(arguments,[["object","undefined"]]),t.$loaded=!1,t.$resolved=!1,t.$localValues={},t.$remoteValues={},t.$version=null,t.$localVersion=null,t.$remoteVersion=null,t.$eventsHandlers={},e&&t.$setValues(e),t.$constructor(e),c&&t.$listen();var r=[];t.$bind(i.MODEL_QUERIED,function(e){r.push(e)}).$bind(i.MODEL_UNQUERIED,function(e){var t=r.indexOf(e);t!=-1&&r.splice(t,1)}).$emit(i.MODEL_INSTANCED)}n.validate(arguments,[null,"string"]);var l={keyPath:"id",autoIncrement:!0},d={},f={},v={},p=null,g=null;return s.getModelName=function(){return a},s.getKeyPath=function(){return l.keyPath},s.autoIncrement=function(e){return n.validate(arguments,["boolean"]),l.autoIncrement=e,s},s.keyPath=function(e){return n.validate(arguments,["string"]),l.keyPath=e,s},s.createStore=function(){return e.createStore(a,l),s},s.index=function(t,n,r){return e.createIndex(a,t,n,r),s},s.build=function(e){return n.validate(arguments,["function"]),e(s),s},s.fields=function(e){return n.validate(arguments,["object"]),v={},v[l.keyPath]={type:"number",required:!0},Object.keys(e).map(function(t){var n=e[t];"string"==typeof e[t]&&(n={type:n}),v[t]=n}),s},s.remote=function(e,t,o){return n.validate(arguments,["string","object","object"]),p=r(e,t,o),s},s.getRemote=function(){return p},s.getVersioning=function(){return g},s.getFieldValue=function(e,t){return u(e,t,function(e,t){return e[t]})},s.setFieldValue=function(e,t,n){return u(e,t,function(e,t){e[t]=n}),e},s.getKeyFrom=function(e){return s.getFieldValue(e,l.keyPath)},s.getInstance=function(e){return n.validate(arguments,[["string","number","undefined"]]),e?(f[e]||(f[e]=new s),f[e]):new s},s.get=function(t){return e.get(s,t)},s.find=function(t){return e.query(s,t)},s.create=function(e){if(n.validate(arguments,["object",["function","undefined"]]),void 0===e.length){var r=s.getInstance(s.getKeyFrom(e));if(r.$loaded)throw new Error("Model.CantCreatedLoadedInstance");return r.$save()}var o=Array.prototype.slice.call(e),i=[],u=t.defer(cb);return function e(){return 0==o.length?u.resolve(i):void s.create(o.shift()).then(function(t){i.push(t),e()}).catch(function(e){u.reject(e)})}(),u},s.versioning=function(t,r){return"function"==typeof t&&(r=t,t=void 0),n.validate([t,r],[["string","undefined"],["function","undefined"]]),g||(t||(t=a+"_versioning"),g=e.model(t).autoIncrement(!1).keyPath("key").fields({hash:{type:"string",required:!0}})),r&&r(g),s},s.bind=function(e,t){return n.validate(arguments,["string",["function","undefined"]]),d[e]||(d[e]=[]),d[e].push(t),s},s.emit=function(e,t){return n.validate(arguments,["string",["undefined","array"]]),d[e]&&d[e].map(function(e){e.apply(s,t||[])}),s},s.prototype.$get=function(e){return s.getFieldValue(this,e)},s.prototype.$set=function(e,t){return s.getFieldValue(this,e,t)},s.prototype.$getValues=function(){var e=this,t={};return Object.keys(v).map(function(n){s.setFieldValue(t,n,s.getFieldValue(e,n))}),t},s.prototype.$getLocalValues=function(){var e=this,t={};return Object.keys(v).map(function(n){s.setFieldValue(t,n,s.getFieldValue(e.$localValues,n))}),t},s.prototype.$getRemoteValues=function(){var e=this,t={};return Object.keys(v).map(function(n){s.setFieldValue(t,n,s.getFieldValue(e.$remoteValues,n))}),t},s.prototype.$setValues=function(e,t){var r=this;return n.validate(arguments,["object",["string","undefined"]]),r.$version=t,Object.keys(e).map(function(t){s.setFieldValue(r,t,e[t])}),r.$loaded=!0,r},s.prototype.$setLocalValues=function(e,t){var r=this;return n.validate(arguments,["object",["string","undefined"]]),r.$localVersion=t,Object.keys(e).map(function(t){s.setFieldValue(r.$localValues,t,e[t])}),r.$loaded||r.$setValues(e,t),r},s.prototype.$setRemoteValues=function(e,t){var r=this;return n.validate(arguments,["object",["string","undefined"]]),r.$remoteVersion=t,Object.keys(e).map(function(t){s.setFieldValue(r.$remoteValues,t,e[t])}),r.$loaded||r.$setValues(e,t),r},s.prototype.$setKey=function(e){var t=s.getKeyFrom(this);if(s.searchDeepField(this,l.keyPath,function(t,n){t[n]=e}),t!==e){if(t&&f[t]&&f[t]!=this)throw new Error("Model.InstanceOfOldKeyIsNotSame");if(e&&f[e]&&f[e]!=this)throw new Error("Model.InstanceOfNewKeyIsNotSame");t&&f[t]&&delete f[t],e&&!f[e]&&(f[e]=this)}return this},s.prototype.$constructor=function(e){},s.prototype.$isStored=function(){return f[this.$get(l.keyPath)]===this},s.getVersionOf=function(e){var n=t.defer();return g?g.get(e).$promise.then(function(e){n.resolve(e)}).catch(function(){n.reject(null)}):o(function(){n.resolve(null)}),n},s.prototype.$save=function(){return n.validate(arguments,["function","undefined"]),e.put(a,this)},s.prototype.$listen=function(){var e=this;if(!c)throw new Error("Model.DoesNotHaveSocketInstance");c.subscribe({modelName:a,eventName:"update",modelId:e.$get(s.getKeyPath())},function(t){o(function(){e.$setRemoteValues(t.values,t.version)})})},s.prototype.$bind=function(e,t){return n.validate(arguments,["string",["function","undefined"]]),this.$eventsHandlers[e]||(this.$eventsHandlers[e]=[]),this.$eventsHandlers[e].push(t),this},s.prototype.$emit=function(e,t){var r=this;return n.validate(arguments,["string",["undefined","array"]]),s.emit(e,[r,[].concat([r]).concat(t)]),r.$eventsHandlers[e]&&r.$eventsHandlers[e].map(function(e){e.apply(r,t||[])}),r},s.$instances=f,s}}n.$inject=["$log","qs","idbUtils","lbResource","$timeout","idbEvents"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e,t,n){"ngInject";return function(e,r,o){var i=this;t.validate(arguments,["object","function",["object","undefined"]]);var u=null;i.getResult=function(n){var i=this;return t.validate(arguments,[["function","undefined"]]),u||(u=e.find(r,o),u.$promise.then(function(){i.getRemoteResult()})),u},i.getRemoteResult=function(e){t.validate(arguments,[["function","undefined"]]);var i=r.getRemote(),a=null;return i&&"function"==typeof i.find&&(a=i.find(o,e).$promise).then(function(e){e.map(function(e,t){r.get(r.getKeyFrom(e.values)).$promise.then(function(r){r.$setRemoteValues(e.values,e.version),u[t]?(u[t]!==r&&u[t].$emit(n.MODEL_UNQUERIED,[u]),u[t]=r):u.push(r),r.$emit(n.MODEL_QUERIED,[u])})})}),a}}}n.$inject=["$log","idbUtils","idbEvents"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e,t,n){"ngInject";function r(r,i,u){var a=this;n.validate(arguments,["string",["string","number"],["string","number"]]);var c=[],s=null;r=r||o,a.connect=function(){s=t.connect(r),s.on("connect",function(){e.log("connected"),s.emit("authentication",{id:i,userId:u}),s.on("authenticated",function(){e.log("User is authenticated")})})},a.subscribe=function(e,t){n.validate(arguments,["object",["function","undefined"]]);var r=e.modelName+"."+e.eventName;"number"==typeof e.modelId&&(r=r+"."+e.modelId),s.on(r,t),c.push(r,t)},a.pushListener=function(e,t){n.validate(arguments,["string",["function","undefined"]]),c.push(e)},a.unsubscribe=function(e){s.removeAllListeners(e);var t=c.indexOf(e);t!=-1&&c.splice(t,1)},a.connect()}var o=null;return r.setUrlServer=function(e){o=e},r.setCredentials=function(e,t){e=$accessTokenId,t=$currentUserId},r}n.$inject=["$log","io","idbUtils"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e){function t(e){var t=e.match(/^(?:https?:)?\/\/([^\/]+)/);return t?t[1]:null}var n=location.host,r=function e(){"ngInject";function t(e,t,n){try{var r=o+t;null==n&&(n=""),e[r]=n}catch(e){console.log("Cannot access local/session storage:",e)}}function n(e){var t=o+e;return localStorage[t]||sessionStorage[t]||null}function e(){var e=this;r.forEach(function(t){e[t]=n(t)}),e.currentUserData=null}var r=["accessTokenId","currentUserId","rememberMe"],o="$idb-lb$";return e.prototype.save=function(){var e=this,n=e.rememberMe?localStorage:sessionStorage;r.forEach(function(r){t(n,r,e[r])})},e.prototype.setUser=function(e,t,n){var r=this;r.accessTokenId=e,r.currentUserId=t,r.currentUserData=n},e.prototype.clearUser=function(){var e=this;e.accessTokenId=null,e.currentUserId=null,e.currentUserData=null},e.prototype.clearStorage=function(){r.forEach(function(e){t(sessionStorage,e,null),t(localStorage,e,null)})},new e},o=function(e,r){"ngInject";return{request:function(o){var i=t(o.url);if(i&&i!==n)return o;if(r.accessTokenId)o.headers[authHeader]=r.accessTokenId;else if(o.__isGetCurrentUser__){var u={body:{error:{status:401}},status:401,config:o,headers:function(){}};return e.reject(u)}return o||e.when(o)}}};o.$inject=["$q","lbAuth"];var i=function(){"ngInject";var e=this,r={urlBase:"/api",authHeader:"authorization"};n=t(r.urlBase)||location.host,e.setAuthHeader=function(e){r.authHeader=e},e.getAuthHeader=function(){return r.authHeader},e.setUrlBase=function(e){r.urlBase=e,n=t(r.urlBase)||location.host},e.getUrlBase=function(){return r.urlBase},e.$get=["$resource",function(e){var t=function(t,n,o){Object.keys(o).map(function(e){o[e].originalUrl=o[e].url,o[e].url=r.urlBase+o[e].url});var i=e(r.urlBase+t,n,o);return i.prototype.$save=function(e,t){var n=i.upsert.call(this,{},this,e,t);return n.$promise||n},i};return t.getUrlBase=function(){return r.urlBase},t.getAuthHeader=function(){return r.authHeader},t}]};return e.factory("lbAuth",r).provider("lbResource",i).factory("lbAuthRequestInterceptor",o).config(["$httpProvider",function(e){"ngInject";e.interceptors.push("lbAuthRequestInterceptor")}])}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}]);