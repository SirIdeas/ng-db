!function(e){function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=t(1),i=r(o),u=t(2),c=r(u),a=t(3),s=r(a),l=t(4),d=r(l),f=t(5),v=r(f),p=t(6),b=r(p),g=t(7),h=r(g),y=t(8),m=r(y);(0,m.default)(angular.module("ng.idb",[])).constant("io",io).constant("idbVersion","0.0.1").service("idbEvents",c.default).service("idbUtils",i.default).service("qs",s.default).service("idb",d.default).service("idbModel",v.default).service("idbQuery",b.default).service("idbSocket",h.default)},function(e,n){"use strict";function t(e){"ngInject";function n(e){return"function"==typeof e||null==e||void 0==e}function t(e){if(!n(e)){var t=new Error("Invalid callback");throw t.name="InvalidCallback",t}}function o(e,n){"string"==typeof n&&(n=[n]);for(var t in n)if(("undefined"==typeof e?"undefined":r(e))==n[t])return;var o=new Error("Invalid value: "+e+" must be "+n.join(" or "));throw o.name="InvalidValue",o}function i(e,n){e=Array.prototype.slice.call(e),"string"==typeof n&&(n=[n]);for(var t in e)if(n[t]){if(null==n[t])continue;if("string"==typeof n[t]||"object"==r(n[t])){o(e[t],n[t]);continue}if("function"==typeof n[t]&&n[t](e[t]))continue;var i=new Error("Invalid validator to: "+e[t]+" must be "+n[t]);throw i.name="InvalidValidator",i}}return{isCallback:n,mustBeCallback:t,mustBe:o,validate:i}}t.$inject=["$q"],Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.default=t},function(e,n){"use strict";function t(){return{DB_ERROR:"cb.error"}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=t},function(e,n){"use strict";function t(){"ngInject";function e(e){function n(){if(o.length){var e=o.shift();e.apply(null,r.resultArgs),i.push(e),n()}}function t(){if(u.length){var e=u.shift();e.apply(null,r.error),c.push(e),t()}}var r=this,o=[],i=[],u=[],c=[];r.promise={},r.$resolved=!1,r.resolve=function(){r.$resolved||(r.$resolved=!0,r.resultArgs=Array.prototype.slice.call(arguments),n())},r.reject=function(e){r.$resolved||(r.$resolved=!0,r.error=e||{},t())},r.promise.then=function(e){return o.push(e),r.$resolved&&!r.error&&n(),r},r.promise.catch=function(e){return u.push(e),r.$resolved&&r.error&&t(),r},r.promise.done=function(e){return o.push(function(){e.apply(null,[null].concat(r.resultArgs))}),u.push(function(){e.apply(null,r.error)}),r.$resolved&&(r.error?t():n()),r},e&&r.promise.done(e)}return e.defer=function(n){return new e(n)},e}Object.defineProperty(n,"__esModule",{value:!0}),n.default=t},function(e,n){"use strict";function t(e,n,t,r,o,i,u,c){"ngInject";function a(u,c,a){var l=this;t.validate(arguments,["string","number",["object","undefined"],["object","undefined"]]);var d={},f=n.defer(),v=n.defer(),p=n.defer(),b=!1,g=null;l.models={},l.bind=function(e,n){t.validate(arguments,["string","function"]),d[e]||(d[e]=[]),d[e].push(n)},l.unbind=function(e,n){if(t.validate(arguments,["string","function"]),d[e]){var r=d[e].indexOf(n);r!=-1&&d[e].splice(r,1)}},l.trigger=function(n,r){t.validate(arguments,["string","object"]),e.log(u+".v"+(c||1)+": "+n);for(var o in d[n])d[n][o].apply(l,r)},l.error=function(e){return l.bind(r.DB_ERROR,e),l},l.open=function(){function n(){var n=s.open(u,c);n.onupgradeneeded=function(e){f.resolve(e,n)},n.onsuccess=function(t){g=n,n.onerror=function(n){e.error("Database error: "+n.target.errorCode),l.trigger(r.DB_ERROR,[n])},v.resolve(t,n)},n.onerror=function(e){v.reject(n.errorCode)}}return b?v:(b=!0,n(),v)},l.model=function(e,n){t.validate(arguments,["string"]);var r=l.models[e];return r||(r=o(l,e,n||a)),l.models[e]=r,r},l.query=function(e,n){return new i(l,e,n)},l.createStore=function(e,n){t.validate(arguments,["string",["object","undefined"]]),f.promise.then(function(t,r){r.result.createObjectStore(e,n)})},l.createIndex=function(e,n,r,o){t.validate(arguments,["string","string","string",["object","undefined"]]),f.promise.then(function(t,i){var u=i.transaction.objectStore(e);u.createIndex(n,r,o)})},l.transaction=function(e,r,o,i){t.validate(arguments,["string","string","function",["function","undefined"]]);var u=n.defer(i);return v.promise.then(function(n,t){var i=t.result.transaction(e,r),c=o(i);i.oncomplete=function(e){u.resolve(e,c)},i.onabort=function(){u.reject(i.error)}}),u},l.put=function(e,r,o){t.validate(arguments,["string",["object","function"],["function","undefined"]]);var i=n.defer(o);return l.transaction(e,"readwrite",function(n){var t=n.objectStore(e).put({values:r.values()});t.onsuccess=function(e){i.resolve(e,r)},t.onerror=function(){i.reject(t)}}),i.$promise},l.get=function(e,r,o){t.validate(arguments,["function","string",null,["function","undefined"]]);var i={};e.searchDeepField({},e.getKeyPath(),function(e,n){e[n]=r});var u=e.getModelName(),c=n.defer(o),a=e.getInstance(r,i);return a.$promise=c.promise,a.$resolved=!1,l.transaction(u,"readonly",function(e){var n=e.objectStore(u),t=n.get(r);t.onsuccess=function(){void 0!=t.result&&(a.setAttributes(t.result,!0),a.$isNew=!1),a.$resolved=!0,c.resolve(a)},t.onerror=function(){c.reject(a)}}),a},l.find=function(e,r,o){t.validate(arguments,["function",["object","undefined"],["function","undefined"]]);var i=e.getModelName(),u=n.defer(o),c=[];return c.$promise=u.promise,c.$resolved=!1,l.transaction(i,"readonly",function(n){var t=n.objectStore(i),r=t.openCursor();r.onsuccess=function(){var n=r.result;if(!n)return c.$resolved=!0,u.resolve(c);var t=e.getInstanceFromObject(n.value.values);t.$isNew=!1,c.push(t),n.continue()}}),c};var h=void 0;Object.keys(h={onOpen:v,onUpgradeNeeded:f,onSocketConnected:p}).map(function(n){h[n].promise.done(function(t){var r=u+".v"+(c||1)+": "+n;t?e.error(r,t):e.log(r)}),l[n]=function(e){return t.validate(arguments,["function"]),h[n].promise.done(e),l}})}var s=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;return s?a:void alert("Su navegador no soporta una versión estable de indexedDB. Tal y como las características no serán validas")}t.$inject=["$log","qs","idbUtils","idbEvents","idbModel","idbQuery","idbSocket","lbAuth"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=t},function(e,n){"use strict";function t(e,n,t,r,o){"ngInject";return function(e,i,u){function c(e){t.validate(arguments,[["object","undefined"]]),this.$record=null,this.$originalValues={},this.setAttributes(e||{},!0),this.constructor(e),u&&this.listen()}t.validate(arguments,[null,"string"]);var a={keyPath:"id",autoIncrement:!0},s={},l={},d=null;return c.getModelName=function(){return i},c.getKeyPath=function(){return a.keyPath},c.autoIncrement=function(e){return t.validate(arguments,["boolean"]),a.autoIncrement=e,c},c.keyPath=function(e){return t.validate(arguments,["string"]),a.keyPath=e,c},c.createStore=function(){return e.createStore(i,a),c},c.index=function(n,t,r){return e.createIndex(i,n,t,r),c},c.build=function(e){return t.validate(arguments,["function"]),e(c),c},c.fields=function(e){return t.validate(arguments,["object"]),l={},l[a.keyPath]={type:"number",required:!0},Object.keys(e).map(function(n){var t=e[n];"string"==typeof e[n]&&(t={type:t}),l[n]=t}),c},c.remote=function(e,n,o){return t.validate(arguments,["string","object","object"]),d=r(e,n,o),c},c.create=function(e,r){if(t.validate(arguments,["object",["function","undefined"]]),void 0===e.length)return c.getInstanceFromObject(e,null).save(r);var o=Array.prototype.slice.call(e),i=[],u=n.defer(r);return function e(){return 0==o.length?u.resolve(i):void c.create(o.shift(),function(n,t){return n?u.reject(n):(i.push(t),void e())})}(),u},c.searchDeepField=function(e,n,r){t.validate(arguments,["object","string","function"]);var o=n.split("."),i=o.pop();return function e(n){if(0==o.length)return r(n,i);var t=o.shift();return"undefined"==typeof n[t]&&(n[t]={}),e(n[t])}(e)},c.getKeyFrom=function(e){return c.searchDeepField(e,a.keyPath,function(e,n){return e[n]})},c.getInstance=function(e,n){return t.validate(arguments,[["string","number","undefined"],["object","undefined"]]),e?(s[e]||(s[e]=new c(n)),s[e]):new c(n)},c.getInstanceFromObject=function(e){return t.validate(arguments,["object"]),c.getInstance(c.getKeyFrom(e),e)},c.get=function(n,t){return e.get(c,n,t)},c.find=function(n){return e.query(c,n)},c.prototype.setAttributes=function(e,n){var r=this;return t.validate(arguments,["object","boolean"]),Object.keys(e).map(function(t){r.set(t,e[t],n)}),r},c.prototype.get=function(e){var n=this;return c.searchDeepField(n,e,function(e,n){return e[n]})},c.prototype.setKey=function(e){var n=this,t=c.getKeyFrom(n);if(c.searchDeepField(n,a.keyPath,function(n,t){n[t]=e}),t!==e){if(t&&s[t]&&s[t]!=n)throw new Error("Model.InstanceOfOldKeyIsNotSame");if(e&&s[e]&&s[e]!=n)throw new Error("Model.InstanceOfNewKeyIsNotSame");t&&s[t]&&delete s[t],e&&!s[e]&&(s[e]=n)}return n},c.prototype.set=function(e,n,r){var o=this;return t.validate(arguments,["string",null,"boolean"]),e===a.keyPath?o.setKey(n):c.searchDeepField(o,e,function(e,t){e[t]=n}),r&&c.searchDeepField(o.$originalValues,e,function(e,t){e[t]=n}),o},c.prototype.values=function(){var e=this,n={};return Object.keys(l).map(function(t){c.searchDeepField(n,t,function(n,r){n[r]=e.get(t)})}),n},c.prototype.constructor=function(e){},c.prototype.isStored=function(){return s[this.get(a.keyPath)]===this},c.prototype.save=function(n){var r=this;return t.validate(arguments,["function","undefined"]),e.put(i,this,function(e,t){if(e)return void(n&&n(e));var o=t.target.result;r.setKey(o),r.$isNew=!1,n&&n.apply(null,[null].concat(Array.prototype.slice.call(arguments)))})},c.prototype.listen=function(){var e=this;if(!u)throw new Error("Model.DoesNotHaveSocketInstance");u.subscribe({modelName:i,eventName:"update",modelId:e.get(c.getKeyPath())},function(n){e.setAttributes(n||{},!0),o(function(){e.save()})})},c.prototype.resource=function(e){return this.$record=e,this},c}}t.$inject=["$log","qs","idbUtils","lbResource","$timeout"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=t},function(e,n){"use strict";function t(e,n){"ngInject";return function(e,t,r){var o=this;n.validate(arguments,["object","function",["object","undefined"]]);var i=null;o.getResult=function(o){return n.validate(arguments,[["function","undefined"]]),i||(i=e.find(t,r,o)),i}}}t.$inject=["$log","idbUtils"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=t},function(e,n){"use strict";function t(e,n,t){"ngInject";function r(r,i,u){var c=this;t.validate(arguments,["string",["string","number"],["string","number"]]);var a=[],s=null;r=r||o,c.connect=function(){s=n.connect(r),s.on("connect",function(){e.log("connected"),s.emit("authentication",{id:i,userId:u}),s.on("authenticated",function(){e.log("User is authenticated")})})},c.subscribe=function(e,n){t.validate(arguments,["object",["function","undefined"]]);var r=e.modelName+"."+e.eventName;"number"==typeof e.modelId&&(r=r+"."+e.modelId),s.on(r,n),a.push(r,n)},c.pushListener=function(e,n){t.validate(arguments,["string",["function","undefined"]]),a.push(e)},c.unsubscribe=function(e){s.removeAllListeners(e);var n=a.indexOf(e);n!=-1&&a.splice(n,1)},c.connect()}var o=null;return r.setUrlServer=function(e){o=e},r.setCredentials=function(e,n){e=$accessTokenId,n=$currentUserId},r}t.$inject=["$log","io","idbUtils"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=t},function(e,n){"use strict";function t(e){function n(e){var n=e.match(/^(?:https?:)?\/\/([^\/]+)/);return n?n[1]:null}var t=location.host,r=function e(){"ngInject";function n(e,n,t){try{var r=o+n;null==t&&(t=""),e[r]=t}catch(e){console.log("Cannot access local/session storage:",e)}}function t(e){var n=o+e;return localStorage[n]||sessionStorage[n]||null}function e(){var e=this;r.forEach(function(n){e[n]=t(n)}),e.currentUserData=null}var r=["accessTokenId","currentUserId","rememberMe"],o="$idb-lb$";return e.prototype.save=function(){var e=this,t=e.rememberMe?localStorage:sessionStorage;r.forEach(function(r){n(t,r,e[r])})},e.prototype.setUser=function(e,n,t){var r=this;r.accessTokenId=e,r.currentUserId=n,r.currentUserData=t},e.prototype.clearUser=function(){var e=this;e.accessTokenId=null,e.currentUserId=null,e.currentUserData=null},e.prototype.clearStorage=function(){r.forEach(function(e){n(sessionStorage,e,null),n(localStorage,e,null)})},new e},o=function(e,r){"ngInject";return{request:function(o){var i=n(o.url);if(i&&i!==t)return o;if(r.accessTokenId)o.headers[authHeader]=r.accessTokenId;else if(o.__isGetCurrentUser__){var u={body:{error:{status:401}},status:401,config:o,headers:function(){}};return e.reject(u)}return o||e.when(o)}}};o.$inject=["$q","lbAuth"];var i=function(){"ngInject";var e=this,r={urlBase:"/api",authHeader:"authorization"};t=n(r.urlBase)||location.host,e.setAuthHeader=function(e){r.authHeader=e},e.getAuthHeader=function(){return r.authHeader},e.setUrlBase=function(e){r.urlBase=e,t=n(r.urlBase)||location.host},e.getUrlBase=function(){return r.urlBase},e.$get=["$resource",function(e){var n=function(n,t,o){Object.keys(o).map(function(e){o[e].originalUrl=o[e].url,o[e].url=r.urlBase+o[e].url});var i=e(r.urlBase+n,t,o);return i.prototype.$save=function(e,n){var t=i.upsert.call(this,{},this,e,n);return t.$promise||t},i};return n.getUrlBase=function(){return r.urlBase},n.getAuthHeader=function(){return r.authHeader},n}]};return e.factory("lbAuth",r).provider("lbResource",i).factory("lbAuthRequestInterceptor",o).config(["$httpProvider",function(e){"ngInject";e.interceptors.push("lbAuthRequestInterceptor")}])}Object.defineProperty(n,"__esModule",{value:!0}),n.default=t}]);